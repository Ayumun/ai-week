---
description: "テストシナリオを実行。ARGUMENTS: ファイル名（必須）、環境（オプション: local|dev）"
allowed-tools: Task, Read, Bash
---

# システムテスト実行コマンド

## あなたの役割
あなたは、テストシナリオファイルを指定してサブエージェントに実行を依頼する**テスト実行コーディネーター**です。

## 実行内容

テストシナリオファイルを実行し、do-system-testサブエージェントを起動してテストを実行します。

### 入力の解析

#### 第1引数: テストシナリオファイル
- フルパスまたはファイル名のみを指定可能

#### 第2引数: 環境指定（オプション）
- 利用可能な環境は `docs/environment/environments.yaml` で定義
- 未指定時は local 環境で実行

### 実行手順

1. **テストファイルパスの確定**

   ```bash
   # フルパスが指定された場合
   TEST_FILE={指定されたファイルパス}

   # ファイル名のみの場合
   TEST_FILE=docs/test/system-test/{ファイル名}
   ```

2. **環境設定の決定**
   - environments.yamlから環境URLを取得
   - 未指定時: local環境、指定時: 該当環境

3. **サブエージェント起動**

   do-system-testサブエージェントを起動：

   ```
   Taskツールで do-system-test サブエージェントを起動

   プロンプト:
   以下のテストシナリオファイルを実行してください：
   {TEST_FILE}

   【重要】実行環境とURL置換：
   - **BASE_URL**: {BASE_URL}
   - **ENVIRONMENT**: {ENVIRONMENT}
   - **URL置換**: テストシナリオ内の"http://localhost:3000"を{BASE_URL}に置換して実行

   【重要】実行時の注意事項：
   - **全体タイムアウト**: テスト実行は最大5分まで
   - **要素待機タイムアウト**: 各要素の待機は最大10秒
   - **継続実行**: エラーが発生しても可能な限り次のステップを実行
   - **エラー記録**: 失敗したステップは詳細を記録

   実行後、以下を報告してください：
   - ✅ 成功したステップと ❌ 失敗したステップの一覧
   - 各失敗の具体的な理由（要素が見つからない、タイムアウト、操作失敗等）
   - シナリオテストがどこまで完了できたか
   - 期待値と異なる挙動がなかったか
   - エラーやバリデーション、画面崩れなど
   - コンソールエラーやdev.logのエラーの有無
   ```

4. **結果の受け取りと報告**

   サブエージェントからの報告をそのまま表示

### ✅ 完了確認

サブエージェントからの報告を確認し、テスト結果をユーザーに伝達

### ⚠️ 注意事項

- テストファイルが存在することを前提とする
- **5分経過時の強制停止**: サブエージェントが5分以上応答しない場合はタイムアウトとして処理
- **エラー時の継続**: 1つの操作が失敗しても全体のテストを中断せず、可能な限り実行を継続
- 実行前にローカルサーバーの起動状態を確認することを推奨
- **部分的成功を評価**: 全ステップが成功しなくても、どこまで実行できたかを明確に報告

## 使用例

```bash
# デフォルト（local環境）
/test:do-system-test user-registration-flow

# dev環境指定
/test:do-system-test user-registration-flow dev
```

## 実行開始

テスト実行を開始します...
